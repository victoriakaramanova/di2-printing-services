@using Di2.Web.ViewModels.OrderSuppliers
@model IEnumerable<OrderSupplierViewModel>

@{
    this.ViewData["Title"] = "Преглед на поръчки";
    //var orderSuppliers = Model.OrderSub.ToList();
}

<style>

</style>
@*<link href="https://cdn.jsdelivr.net/css-toggle-switch/latest/toggle-switch.css" rel="stylesheet" />
<style>
    .switch-toggle {
        width: 10em;
    }
        .switch-toggle label:not(.disabled) {
            cursor: pointer;
        }
</style>*@

<div class="text-center">
    <h2 class="display-3">@this.ViewData["Title"]</h2>
</div>
<hr />

@for (int i = 0; i < Model.ToList().Count; i++)
{
    @Model.ToList()[i].Material.Name
    @Model.ToList()[i].Material.Description
    <time datetime="@Model.ToList()[i].OrderDate.ToString("O")">@Model.ToList()[i].OrderDate.ToString("dd.MM.yyyy HH:mm")</time>
    @Model.ToList()[i].Supplier.Name
    @Model.ToList()[i].UnitPrice
    @Model.ToList()[i].Quantity
    @Model.ToList()[i].TotalPrice
    <form id="checkForm-@i" method="post"></form>
    <div class="v-switcher-wrapper" style="margin:15px;">
        <input type="range" id="switcher-@i" 
               name="switcher-@i" class="@Model.ToList()[i].SwitchValue"
               min="-1" max="1" step="1" 
               onchange="sendStatus(@Model.ToList()[i].Id,@i)" />
    </div>
    @*<div class="switch-toggle switch-3 switch-candy">
            <input id="0" name="state-d" type="radio" checked="" />
            <label for="0" onclick="sendStatus(@Model.ToList()[i].Id,@i, true)">Завършена</label>

            <input id="1" name="state-d" type="radio" disabled checked="checked" />
            <label for="1" class="disabled" onclick="">Изпратена</label>

            <input id="-1" name="state-d" type="radio" />
            <label for="-1" onclick="sendStatus(@Model.ToList()[i].Id,@i, false)">Канселирана</label>
            <a></a>
        </div>*@

    <div id="statusId-@i">@Model.ToList()[i].Status</div>
}

@section Scripts {
    <script>
        function sendStatus(orderId, i, isCompleted) {
            var token = $(`#checkForm-${i} input[name = __RequestVerificationToken]`).val();
            let myInput = Number($(`#switcher-${i}`).val());
            //debugger
            switch (myInput.toString()) {
                case '-1': $(`#switcher-${i}`).removeClass();
                    $(`#switcher-${i}`).addClass('v-switcher v-switcher-mode--tri v-switcher-state--passive');
                    break;
                case '0': $(`#switcher-${i}`).removeClass();
                    $(`#switcher-${i}`).addClass('v-switcher v-switcher-mode--tri v-switcher-state--neutral');
                    // $(`#switcher-${i}`)["disabled" = true];
                    break;
                case '1': $(`#switcher-${i}`).removeClass();
                    $(`#switcher-${i}`).addClass('v-switcher v-switcher-mode--tri v-switcher-state--active');
                    break;
            }
            var json = { orderId: orderId, i: i, isCompleted: myInput };
            //$("#statusId").empty();
            //debugger
            $.ajax({
                url: "/api/totals",
                type: "POST",
                data: JSON.stringify(json),
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                headers: { 'X-CSRF-TOKEN': token },
                    success: function (data) {
                        //$("#statusId").html(data.toString());
                        //debugger
                        if (data.toString() == 1) {
                            $(`#statusId-${i}`).html("Sent")
                        } else if (data.toString() == -1) {
                            $(`#statusId-${i}`).html("Canceled")
                        }
                        else $(`#statusId-${i}`).html("Completed");
                }
            });
        }
    </script>

}

